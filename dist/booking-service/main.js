(()=>{"use strict";const e=require("@nestjs/core"),t=require("tslib"),o=require("@nestjs/common"),r=require("@nestjs/config"),s=require("@nestjs/mongoose");class Booking{constructor(e){this.id=e.id,this.userId=e.userId,this.serviceType=e.serviceType,this.status=e.status}toPrimitives(){return{id:this.id,userId:this.userId,serviceType:this.serviceType,status:this.status}}static fromPrimitives(e){return new Booking({id:e.id,userId:e.userId,serviceType:e.serviceType,status:e.status})}}var a,i;!function(e){e.PENDING="PENDING",e.CONFIRMED="CONFIRMED",e.CANCELLED="CANCELLED"}(a||(a={})),function(e){e.TOUR="TOUR",e.TRANSPORT="TRANSPORT",e.ACCOMMODATION="ACCOMMODATION"}(i||(i={}));const n=Symbol("IBookingRepository");class CreateBookingDto{}const d=require("mongoose"),c=require("neverthrow");var p,u,y,_,m;let g=class MoneySchema{};(0,t.__decorate)([(0,s.Prop)({required:!0}),(0,t.__metadata)("design:type",Number)],g.prototype,"amount",void 0),(0,t.__decorate)([(0,s.Prop)({required:!0}),(0,t.__metadata)("design:type",String)],g.prototype,"currency",void 0),g=(0,t.__decorate)([(0,s.Schema)({_id:!1})],g);let l=class BookingModelSchema{};(0,t.__decorate)([(0,s.Prop)({required:!0,unique:!0}),(0,t.__metadata)("design:type",String)],l.prototype,"id",void 0),(0,t.__decorate)([(0,s.Prop)({required:!0,index:!0}),(0,t.__metadata)("design:type",String)],l.prototype,"userId",void 0),(0,t.__decorate)([(0,s.Prop)({required:!0,index:!0}),(0,t.__metadata)("design:type",String)],l.prototype,"serviceId",void 0),(0,t.__decorate)([(0,s.Prop)({required:!0,enum:["transport","accommodation","tour","experience"]}),(0,t.__metadata)("design:type","function"==typeof(p=void 0!==i&&i)?p:Object)],l.prototype,"serviceType",void 0),(0,t.__decorate)([(0,s.Prop)({required:!0,type:g}),(0,t.__metadata)("design:type",g)],l.prototype,"totalPrice",void 0),(0,t.__decorate)([(0,s.Prop)({required:!0,enum:["pending","confirmed","cancelled","completed"]}),(0,t.__metadata)("design:type","function"==typeof(u=void 0!==a&&a)?u:Object)],l.prototype,"status",void 0),(0,t.__decorate)([(0,s.Prop)({required:!0}),(0,t.__metadata)("design:type","function"==typeof(y="undefined"!=typeof Date&&Date)?y:Object)],l.prototype,"createdAt",void 0),(0,t.__decorate)([(0,s.Prop)({required:!0}),(0,t.__metadata)("design:type","function"==typeof(_="undefined"!=typeof Date&&Date)?_:Object)],l.prototype,"startDate",void 0),(0,t.__decorate)([(0,s.Prop)(),(0,t.__metadata)("design:type","function"==typeof(m="undefined"!=typeof Date&&Date)?m:Object)],l.prototype,"endDate",void 0),l=(0,t.__decorate)([(0,s.Schema)({timestamps:!0,_id:!1})],l);const v=s.SchemaFactory.createForClass(l);var f;v.index({userId:1,status:1}),v.index({serviceId:1,serviceType:1});let B=class MongooseBookingRepository{constructor(e){this.model=e}async save(e){try{const t=e.toPrimitives(),o=new this.model(t);return await o.save(),(0,c.ok)(void 0)}catch(t){return(0,c.err)(new Error(t.message))}}async update(e){try{const t=e.toPrimitives();return await this.model.updateOne({id:e.id},{$set:t}).exec(),(0,c.ok)(void 0)}catch(t){return(0,c.err)(new Error(t.message))}}async findById(e){try{const t=await this.model.findOne({id:e}).exec();return(0,c.ok)(t?this.toDomain(t):null)}catch(t){return(0,c.err)(new Error(t.message))}}async findByUserId(e){try{const t=await this.model.find({userId:e}).sort({createdAt:-1}).exec();return(0,c.ok)(t.map(this.toDomain))}catch(t){return(0,c.err)(new Error(t.message))}}async findByServiceId(e,t){try{const o=await this.model.find({serviceId:e,serviceType:t}).exec();return(0,c.ok)(o.map(this.toDomain))}catch(o){return(0,c.err)(new Error(o.message))}}toDomain(e){return Booking.fromPrimitives(e.toObject())}};B=(0,t.__decorate)([(0,o.Injectable)(),(0,t.__param)(0,(0,s.InjectModel)(l.name)),(0,t.__metadata)("design:paramtypes",["function"==typeof(f=void 0!==d.Model&&d.Model)?f:Object])],B);let I=class InfrastructureModule{};I=(0,t.__decorate)([(0,o.Module)({imports:[s.MongooseModule.forFeature([{name:l.name,schema:v}])],providers:[{provide:n,useClass:B}],exports:[n]})],I);class CreateBookingUseCase{execute(e){return"Booking Created"}}class FindBookingsByUserUseCase{execute(e){return[]}}const h=require("uuid"),C={generate:()=>(0,h.v4)(),isValid:e=>(0,h.validate)(e)};const k=require("class-validator");class MoneyDto{}(0,t.__decorate)([(0,k.IsNotEmpty)(),(0,k.IsNumber)(),(0,k.Min)(0),(0,t.__metadata)("design:type",Number)],MoneyDto.prototype,"amount",void 0),(0,t.__decorate)([(0,k.IsNotEmpty)(),(0,k.IsIn)(["USD"]),(0,t.__metadata)("design:type",String)],MoneyDto.prototype,"currency",void 0);class LocationDto{}var D,O,P,N,M,U;(0,t.__decorate)([(0,k.IsNotEmpty)(),(0,k.IsString)(),(0,t.__metadata)("design:type",String)],LocationDto.prototype,"address",void 0),(0,t.__decorate)([(0,k.IsNotEmpty)(),(0,k.IsString)(),(0,t.__metadata)("design:type",String)],LocationDto.prototype,"city",void 0),(0,t.__decorate)([(0,k.IsNotEmpty)(),(0,k.IsString)(),(0,t.__metadata)("design:type",String)],LocationDto.prototype,"country",void 0),(0,t.__decorate)([(0,k.IsNotEmpty)(),(0,k.IsLatitude)(),(0,t.__metadata)("design:type",Number)],LocationDto.prototype,"latitude",void 0),(0,t.__decorate)([(0,k.IsNotEmpty)(),(0,k.IsLongitude)(),(0,t.__metadata)("design:type",Number)],LocationDto.prototype,"longitude",void 0);let b=class BookingController{constructor(e,t){this.createBookingUseCase=e,this.findBookingsByUserUseCase=t}async createBooking(e){return this.createBookingUseCase.execute(e)}async getBookingsByUser(e){return this.findBookingsByUserUseCase.execute(e)}};(0,t.__decorate)([(0,o.Post)(),(0,t.__param)(0,(0,o.Body)()),(0,t.__metadata)("design:type",Function),(0,t.__metadata)("design:paramtypes",["function"==typeof(P=void 0!==CreateBookingDto&&CreateBookingDto)?P:Object]),(0,t.__metadata)("design:returntype","function"==typeof(N="undefined"!=typeof Promise&&Promise)?N:Object)],b.prototype,"createBooking",null),(0,t.__decorate)([(0,o.Get)("user/:userId"),(0,t.__param)(0,(0,o.Param)("userId")),(0,t.__metadata)("design:type",Function),(0,t.__metadata)("design:paramtypes",["function"==typeof(M=C)?M:Object]),(0,t.__metadata)("design:returntype","function"==typeof(U="undefined"!=typeof Promise&&Promise)?U:Object)],b.prototype,"getBookingsByUser",null),b=(0,t.__decorate)([(0,o.Controller)("bookings"),(0,t.__metadata)("design:paramtypes",["function"==typeof(D=void 0!==CreateBookingUseCase&&CreateBookingUseCase)?D:Object,"function"==typeof(O=void 0!==FindBookingsByUserUseCase&&FindBookingsByUserUseCase)?O:Object])],b);let S=class AppModule{};S=(0,t.__decorate)([(0,o.Module)({imports:[r.ConfigModule.forRoot({isGlobal:!0}),s.MongooseModule.forRoot(process.env.BOOKING_DB_URL),I],controllers:[b],providers:[CreateBookingUseCase,FindBookingsByUserUseCase]})],S),async function(){const t=await e.NestFactory.create(S),r=process.env.PORT||3010;t.useGlobalPipes(new o.ValidationPipe({whitelist:!0,transform:!0})),await t.listen(r),o.Logger.log(`\ud83d\ude80 Booking-Service est\xe1 corriendo en http://localhost:${r}`,"Bootstrap")}()})();