{"version":3,"file":"main.js","mappings":"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","sources":["external commonjs \"tslib\"","external commonjs \"@nestjs/core\"","external commonjs \"@nestjs/common\"","external commonjs \"@nestjs/config\"","external commonjs \"@prisma/client\"","C:\\Users\\USER1\\going-monorepo-clean\\libs\\shared\\prisma-client\\src\\lib\\prisma.service.ts","C:\\Users\\USER1\\going-monorepo-clean\\libs\\shared\\prisma-client\\src\\lib\\prisma.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\libs\\domains\\tour\\core\\src\\lib\\entities\\tour.entity.ts","C:\\Users\\USER1\\going-monorepo-clean\\libs\\domains\\tour\\core\\src\\lib\\ports\\itour.repository.ts","C:\\Users\\USER1\\going-monorepo-clean\\tours-service\\src\\infrastructure\\persistence\\prisma-tour.repository.ts","C:\\Users\\USER1\\going-monorepo-clean\\tours-service\\src\\infrastructure\\infrastructure.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\libs\\domains\\tour\\application\\src\\lib\\use-cases\\create-tour.use-case.ts","C:\\Users\\USER1\\going-monorepo-clean\\libs\\domains\\tour\\application\\src\\lib\\tour-application.module.ts","external commonjs \"class-validator\"","C:\\Users\\USER1\\going-monorepo-clean\\libs\\domains\\tour\\application\\src\\lib\\dto\\create-tour.dto.ts","C:\\Users\\USER1\\going-monorepo-clean\\tours-service\\src\\api\\tours.controller.ts","C:\\Users\\USER1\\going-monorepo-clean\\tours-service\\src\\app.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\tours-service\\src\\main.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = require(\"tslib\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/core\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/common\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/config\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@prisma/client\");","import { Injectable, OnModuleInit, OnModuleDestroy, Logger } from '@nestjs/common';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\n@Injectable()\r\nexport class PrismaService extends PrismaClient implements OnModuleInit, OnModuleDestroy {\r\n  private readonly logger = new Logger(PrismaService.name);\r\n\r\n  constructor() {\r\n    super({\r\n      log: process.env.NODE_ENV === 'development' \r\n        ? ['query', 'info', 'warn', 'error'] \r\n        : ['error'],\r\n    });\r\n  }\r\n\r\n  async onModuleInit() {\r\n    try {\r\n      await this.$connect();\r\n      this.logger.log('Connected to PostgreSQL database');\r\n    } catch (error) {\r\n      this.logger.error('Failed to connect to PostgreSQL database', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async onModuleDestroy() {\r\n    await this.$disconnect();\r\n    this.logger.log('Disconnected from PostgreSQL database');\r\n  }\r\n\r\n  /**\r\n   * Execute operations within a transaction\r\n   * All operations succeed or all fail together\r\n   */\r\n  async executeTransaction<T>(\r\n    fn: (tx: Omit<PrismaClient, '$connect' | '$disconnect' | '$on' | '$transaction' | '$use'>) => Promise<T>,\r\n  ): Promise<T> {\r\n    return this.$transaction(fn);\r\n  }\r\n\r\n  /**\r\n   * Clean database for testing purposes\r\n   * WARNING: This deletes all data!\r\n   */\r\n  async cleanDatabase() {\r\n    if (process.env.NODE_ENV !== 'test') {\r\n      throw new Error('cleanDatabase can only be used in test environment');\r\n    }\r\n    \r\n    const tablenames = await this.$queryRaw<Array<{ tablename: string }>>`\r\n      SELECT tablename FROM pg_tables WHERE schemaname='public'\r\n    `;\r\n\r\n    for (const { tablename } of tablenames) {\r\n      if (tablename !== '_prisma_migrations') {\r\n        await this.$executeRawUnsafe(`TRUNCATE TABLE \"public\".\"${tablename}\" CASCADE;`);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Global, Module } from '@nestjs/common';\r\nimport { PrismaService } from './prisma.service';\r\n\r\n@Global()\r\n@Module({\r\n  providers: [PrismaService],\r\n  exports: [PrismaService],\r\n})\r\nexport class PrismaModule {}\r\n","import { Money, Location } from '@going-monorepo-clean/shared-domain';\r\n\r\nexport type TourStatus = 'DRAFT' | 'PUBLISHED' | 'ARCHIVED';\r\n\r\nexport interface TourProps {\r\n  id: string;\r\n  hostId: string;\r\n  title: string;\r\n  description: string;\r\n  pricePerPerson: number;\r\n  currency: string;\r\n  maxCapacity: number;\r\n  durationHours: number;\r\n  location: string;\r\n  meetingPoint: string;\r\n  status: TourStatus;\r\n  createdAt: Date;\r\n  updatedAt: Date;\r\n}\r\n\r\nexport class Tour {\r\n  id: string;\r\n  hostId: string;\r\n  title: string;\r\n  description: string;\r\n  pricePerPerson: number;\r\n  currency: string;\r\n  maxCapacity: number;\r\n  durationHours: number;\r\n  location: string;\r\n  meetingPoint: string;\r\n  status: TourStatus;\r\n  readonly createdAt: Date;\r\n  updatedAt: Date;\r\n\r\n  private constructor(props: TourProps) {\r\n    this.id = props.id;\r\n    this.hostId = props.hostId;\r\n    this.title = props.title;\r\n    this.description = props.description;\r\n    this.pricePerPerson = props.pricePerPerson;\r\n    this.currency = props.currency;\r\n    this.maxCapacity = props.maxCapacity;\r\n    this.durationHours = props.durationHours;\r\n    this.location = props.location;\r\n    this.meetingPoint = props.meetingPoint;\r\n    this.status = props.status;\r\n    this.createdAt = props.createdAt;\r\n    this.updatedAt = props.updatedAt;\r\n  }\r\n\r\n  public static create(props: {\r\n    hostId: string;\r\n    title: string;\r\n    description: string;\r\n    pricePerPerson: number;\r\n    currency: string;\r\n    maxCapacity: number;\r\n    durationHours: number;\r\n    location: string;\r\n    meetingPoint: string;\r\n  }): Tour {\r\n    return new Tour({\r\n      id: crypto.randomUUID(),\r\n      ...props,\r\n      status: 'DRAFT',\r\n      createdAt: new Date(),\r\n      updatedAt: new Date(),\r\n    });\r\n  }\r\n\r\n  public static fromPrimitives(props: TourProps): Tour {\r\n    return new Tour(props);\r\n  }\r\n\r\n  public toPrimitives(): TourProps {\r\n    return {\r\n      id: this.id,\r\n      hostId: this.hostId,\r\n      title: this.title,\r\n      description: this.description,\r\n      pricePerPerson: this.pricePerPerson,\r\n      currency: this.currency,\r\n      maxCapacity: this.maxCapacity,\r\n      durationHours: this.durationHours,\r\n      location: this.location,\r\n      meetingPoint: this.meetingPoint,\r\n      status: this.status,\r\n      createdAt: this.createdAt,\r\n      updatedAt: this.updatedAt,\r\n    };\r\n  }\r\n\r\n  publish(): void {\r\n    if (this.status === 'PUBLISHED') {\r\n      throw new Error('Tour is already published.');\r\n    }\r\n    this.status = 'PUBLISHED';\r\n    this.updatedAt = new Date();\r\n  }\r\n\r\n  archive(): void {\r\n    this.status = 'ARCHIVED';\r\n    this.updatedAt = new Date();\r\n  }\r\n\r\n  update(props: Partial<Omit<TourProps, 'id' | 'hostId' | 'createdAt' | 'updatedAt'>>): void {\r\n    if (props.title) this.title = props.title;\r\n    if (props.description) this.description = props.description;\r\n    if (props.pricePerPerson) this.pricePerPerson = props.pricePerPerson;\r\n    if (props.currency) this.currency = props.currency;\r\n    if (props.maxCapacity) this.maxCapacity = props.maxCapacity;\r\n    if (props.durationHours) this.durationHours = props.durationHours;\r\n    if (props.location) this.location = props.location;\r\n    if (props.meetingPoint) this.meetingPoint = props.meetingPoint;\r\n    \r\n    this.updatedAt = new Date();\r\n  }\r\n}\r\n","import { Tour } from '../entities/tour.entity';\r\n\r\nexport const ITourRepository = Symbol('ITourRepository');\r\n\r\nexport interface ITourRepository {\r\n  save(tour: Tour): Promise<void>;\r\n  findById(id: string): Promise<Tour | null>;\r\n  findByHostId(hostId: string): Promise<Tour[]>;\r\n  search(filters: { location?: string; minPrice?: number; maxPrice?: number }): Promise<Tour[]>;\r\n  update(tour: Tour): Promise<void>;\r\n}\r\n","import { Injectable } from '@nestjs/common';\r\nimport { PrismaService } from '@going-monorepo-clean/prisma-client';\r\nimport { ITourRepository, Tour, TourStatus } from '@going-monorepo-clean/domains-tour-core';\r\n\r\n@Injectable()\r\nexport class PrismaTourRepository implements ITourRepository {\r\n  constructor(private readonly prisma: PrismaService) {}\r\n\r\n  async save(tour: Tour): Promise<void> {\r\n    const primitives = tour.toPrimitives();\r\n\r\n    await this.prisma.tour.upsert({\r\n      where: { id: primitives.id },\r\n      create: {\r\n        id: primitives.id,\r\n        hostId: primitives.hostId,\r\n        title: primitives.title,\r\n        description: primitives.description,\r\n        pricePerPerson: primitives.pricePerPerson,\r\n        currency: primitives.currency,\r\n        maxCapacity: primitives.maxCapacity,\r\n        durationHours: primitives.durationHours,\r\n        location: primitives.location,\r\n        meetingPoint: primitives.meetingPoint,\r\n        status: this.toPrismaStatus(primitives.status),\r\n      },\r\n      update: {\r\n        title: primitives.title,\r\n        description: primitives.description,\r\n        pricePerPerson: primitives.pricePerPerson,\r\n        currency: primitives.currency,\r\n        maxCapacity: primitives.maxCapacity,\r\n        durationHours: primitives.durationHours,\r\n        location: primitives.location,\r\n        meetingPoint: primitives.meetingPoint,\r\n        status: this.toPrismaStatus(primitives.status),\r\n      },\r\n    });\r\n  }\r\n\r\n  async findById(id: string): Promise<Tour | null> {\r\n    const record = await this.prisma.tour.findUnique({\r\n      where: { id },\r\n    });\r\n\r\n    if (!record) return null;\r\n\r\n    return this.toDomain(record);\r\n  }\r\n\r\n  async findByHostId(hostId: string): Promise<Tour[]> {\r\n    const records = await this.prisma.tour.findMany({\r\n      where: { hostId },\r\n    });\r\n\r\n    return records.map(r => this.toDomain(r));\r\n  }\r\n\r\n  async search(filters: { location?: string; minPrice?: number; maxPrice?: number }): Promise<Tour[]> {\r\n    const records = await this.prisma.tour.findMany({\r\n      where: {\r\n        status: 'PUBLISHED',\r\n        ...(filters.location && { location: { contains: filters.location } }),\r\n        ...(filters.minPrice && { pricePerPerson: { gte: filters.minPrice } }),\r\n        ...(filters.maxPrice && { pricePerPerson: { lte: filters.maxPrice } }),\r\n      },\r\n    });\r\n\r\n    return records.map(r => this.toDomain(r));\r\n  }\r\n\r\n  async update(tour: Tour): Promise<void> {\r\n    await this.save(tour);\r\n  }\r\n\r\n  private toPrismaStatus(status: TourStatus): 'DRAFT' | 'PUBLISHED' | 'ARCHIVED' {\r\n    return status;\r\n  }\r\n\r\n  private toDomain(record: any): Tour {\r\n    return Tour.fromPrimitives({\r\n      id: record.id,\r\n      hostId: record.hostId,\r\n      title: record.title,\r\n      description: record.description,\r\n      pricePerPerson: Number(record.pricePerPerson),\r\n      currency: record.currency,\r\n      maxCapacity: record.maxCapacity,\r\n      durationHours: Number(record.durationHours),\r\n      location: record.location,\r\n      meetingPoint: record.meetingPoint,\r\n      status: record.status as TourStatus,\r\n      createdAt: record.createdAt,\r\n      updatedAt: record.updatedAt,\r\n    });\r\n  }\r\n}\r\n","import { Module, Global } from '@nestjs/common';\r\nimport { ConfigModule } from '@nestjs/config';\r\n\r\n// Shared Prisma Module\r\nimport { PrismaModule, PrismaService } from '@going-monorepo-clean/prisma-client';\r\n\r\n// Domain Ports\r\nimport { ITourRepository } from '@going-monorepo-clean/domains-tour-core';\r\n\r\n// Repository Implementation\r\nimport { PrismaTourRepository } from './persistence/prisma-tour.repository';\r\n\r\n@Global()\r\n@Module({\r\n  imports: [\r\n    ConfigModule.forRoot({ isGlobal: true }),\r\n    PrismaModule,\r\n  ],\r\n  providers: [\r\n    {\r\n      provide: ITourRepository,\r\n      useClass: PrismaTourRepository,\r\n    },\r\n    PrismaTourRepository,\r\n  ],\r\n  exports: [ITourRepository, PrismaTourRepository],\r\n})\r\nexport class InfrastructureModule {}\r\n","import { Inject, Injectable } from '@nestjs/common';\r\nimport { ITourRepository, Tour } from '@going-monorepo-clean/domains-tour-core';\r\nimport { CreateTourDto } from '../dto/create-tour.dto';\r\n\r\n@Injectable()\r\nexport class CreateTourUseCase {\r\n  constructor(\r\n    @Inject(ITourRepository)\r\n    private readonly tourRepo: ITourRepository,\r\n  ) {}\r\n\r\n  async execute(dto: CreateTourDto): Promise<{ id: string }> {\r\n    const tour = Tour.create({\r\n      hostId: dto.hostId,\r\n      title: dto.title,\r\n      description: dto.description,\r\n      pricePerPerson: dto.pricePerPerson,\r\n      currency: dto.currency,\r\n      maxCapacity: dto.maxCapacity,\r\n      durationHours: dto.durationHours,\r\n      location: dto.location,\r\n      meetingPoint: dto.meetingPoint,\r\n    });\r\n\r\n    await this.tourRepo.save(tour);\r\n\r\n    return { id: tour.id };\r\n  }\r\n}\r\n","import { Module } from '@nestjs/common';\r\nimport { CreateTourUseCase } from './use-cases/create-tour.use-case';\r\n// Import other use cases if needed\r\n\r\n@Module({\r\n  providers: [\r\n    CreateTourUseCase,\r\n  ],\r\n  exports: [\r\n    CreateTourUseCase,\r\n  ],\r\n})\r\nexport class TourApplicationModule {}\r\n","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"class-validator\");","import { IsNotEmpty, IsString, IsNumber, Min, IsIn } from 'class-validator';\r\n\r\nexport class CreateTourDto {\r\n  @IsNotEmpty()\r\n  @IsString()\r\n  hostId: string;\r\n\r\n  @IsNotEmpty()\r\n  @IsString()\r\n  title: string;\r\n\r\n  @IsNotEmpty()\r\n  @IsString()\r\n  description: string;\r\n\r\n  @IsNotEmpty()\r\n  @IsNumber()\r\n  @Min(0)\r\n  pricePerPerson: number;\r\n\r\n  @IsNotEmpty()\r\n  @IsIn(['USD', 'EUR'])\r\n  currency: string;\r\n\r\n  @IsNotEmpty()\r\n  @IsNumber()\r\n  @Min(1)\r\n  maxCapacity: number;\r\n\r\n  @IsNotEmpty()\r\n  @IsNumber()\r\n  @Min(1)\r\n  durationHours: number;\r\n\r\n  @IsNotEmpty()\r\n  @IsString()\r\n  location: string;\r\n\r\n  @IsNotEmpty()\r\n  @IsString()\r\n  meetingPoint: string;\r\n}","import { Body, Controller, Post } from '@nestjs/common';\r\nimport { CreateTourUseCase, CreateTourDto } from '@going-monorepo-clean/domains-tour-application';\r\n\r\n@Controller('tours')\r\nexport class ToursController {\r\n  constructor(\r\n    private readonly createTourUseCase: CreateTourUseCase,\r\n  ) {}\r\n\r\n  @Post()\r\n  async createTour(@Body() dto: CreateTourDto) {\r\n    return this.createTourUseCase.execute(dto);\r\n  }\r\n}\r\n","import { Module } from '@nestjs/common';\r\nimport { ConfigModule } from '@nestjs/config';\r\nimport { InfrastructureModule } from './infrastructure/infrastructure.module';\r\nimport { TourApplicationModule } from '@going-monorepo-clean/domains-tour-application';\r\nimport { ToursController } from './api/tours.controller';\r\n\r\n@Module({\r\n  imports: [\r\n    ConfigModule.forRoot({ isGlobal: true }),\r\n    InfrastructureModule,\r\n    TourApplicationModule,\r\n  ],\r\n  controllers: [ToursController],\r\n  providers: [],\r\n})\r\nexport class AppModule {}","import { NestFactory } from '@nestjs/core';\r\nimport { AppModule } from './app.module';\r\nimport { Logger, ValidationPipe } from '@nestjs/common';\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n  const port = process.env.PORT || 3009;\r\n  \r\n  app.enableCors();\r\n  app.setGlobalPrefix('api');\r\n  \r\n  app.useGlobalPipes(new ValidationPipe({ whitelist: true, transform: true }));\r\n  await app.listen(port);\r\n  Logger.log(\r\n    `ðŸš€ Tours-Service estÃ¡ corriendo en http://localhost:${port}/api`,\r\n    'Bootstrap',\r\n  );\r\n}\r\nbootstrap();"],"names":["require","PrismaService","PrismaClient","constructor","super","log","process","env","NODE_ENV","logger","Logger","name","onModuleInit","this","$connect","error","onModuleDestroy","$disconnect","executeTransaction","fn","$transaction","cleanDatabase","Error","tablenames","$queryRaw","tablename","$executeRawUnsafe","Injectable","PrismaModule","Global","Module","providers","exports","Tour","props","id","hostId","title","description","pricePerPerson","currency","maxCapacity","durationHours","location","meetingPoint","status","createdAt","updatedAt","create","crypto","randomUUID","Date","fromPrimitives","toPrimitives","publish","archive","update","ITourRepository","Symbol","PrismaTourRepository","prisma","save","tour","primitives","upsert","where","toPrismaStatus","findById","record","findUnique","toDomain","findByHostId","findMany","map","r","search","filters","contains","minPrice","gte","maxPrice","lte","Number","InfrastructureModule","imports","ConfigModule","forRoot","isGlobal","provide","useClass","CreateTourUseCase","tourRepo","execute","dto","Inject","TourApplicationModule","CreateTourDto","IsNotEmpty","IsString","IsNumber","Min","IsIn","ToursController","createTourUseCase","createTour","Post","Body","Controller","AppModule","controllers","app","NestFactory","port","PORT","enableCors","setGlobalPrefix","useGlobalPipes","ValidationPipe","whitelist","transform","listen","bootstrap"],"ignoreList":[],"sourceRoot":""}