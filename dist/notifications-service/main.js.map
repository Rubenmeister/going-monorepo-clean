{"version":3,"file":"main.js","mappings":"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","sources":["external commonjs \"tslib\"","external commonjs \"@nestjs/core\"","external commonjs \"@nestjs/common\"","external commonjs \"@nestjs/config\"","external commonjs \"@prisma/client\"","C:\\Users\\USER1\\going-monorepo-clean\\libs\\shared\\prisma-client\\src\\lib\\prisma.service.ts","C:\\Users\\USER1\\going-monorepo-clean\\libs\\shared\\prisma-client\\src\\lib\\prisma.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\notifications-service\\src\\infrastructure\\persistence\\prisma-notification.repository.ts","C:\\Users\\USER1\\going-monorepo-clean\\notifications-service\\src\\infrastructure\\infrastructure.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\notifications-service\\src\\app.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\notifications-service\\src\\main.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = require(\"tslib\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/core\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/common\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/config\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@prisma/client\");","import { Injectable, OnModuleInit, OnModuleDestroy, Logger } from '@nestjs/common';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\n@Injectable()\r\nexport class PrismaService extends PrismaClient implements OnModuleInit, OnModuleDestroy {\r\n  private readonly logger = new Logger(PrismaService.name);\r\n\r\n  constructor() {\r\n    super({\r\n      log: process.env.NODE_ENV === 'development' \r\n        ? ['query', 'info', 'warn', 'error'] \r\n        : ['error'],\r\n    });\r\n  }\r\n\r\n  async onModuleInit() {\r\n    try {\r\n      await this.$connect();\r\n      this.logger.log('Connected to PostgreSQL database');\r\n    } catch (error) {\r\n      this.logger.error('Failed to connect to PostgreSQL database', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async onModuleDestroy() {\r\n    await this.$disconnect();\r\n    this.logger.log('Disconnected from PostgreSQL database');\r\n  }\r\n\r\n  /**\r\n   * Execute operations within a transaction\r\n   * All operations succeed or all fail together\r\n   */\r\n  async executeTransaction<T>(\r\n    fn: (tx: Omit<PrismaClient, '$connect' | '$disconnect' | '$on' | '$transaction' | '$use'>) => Promise<T>,\r\n  ): Promise<T> {\r\n    return this.$transaction(fn);\r\n  }\r\n\r\n  /**\r\n   * Clean database for testing purposes\r\n   * WARNING: This deletes all data!\r\n   */\r\n  async cleanDatabase() {\r\n    if (process.env.NODE_ENV !== 'test') {\r\n      throw new Error('cleanDatabase can only be used in test environment');\r\n    }\r\n    \r\n    const tablenames = await this.$queryRaw<Array<{ tablename: string }>>`\r\n      SELECT tablename FROM pg_tables WHERE schemaname='public'\r\n    `;\r\n\r\n    for (const { tablename } of tablenames) {\r\n      if (tablename !== '_prisma_migrations') {\r\n        await this.$executeRawUnsafe(`TRUNCATE TABLE \"public\".\"${tablename}\" CASCADE;`);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Global, Module } from '@nestjs/common';\r\nimport { PrismaService } from './prisma.service';\r\n\r\n@Global()\r\n@Module({\r\n  providers: [PrismaService],\r\n  exports: [PrismaService],\r\n})\r\nexport class PrismaModule {}\r\n","import { Injectable } from '@nestjs/common';\r\nimport { PrismaService } from '@going-monorepo-clean/prisma-client';\r\n\r\n@Injectable()\r\nexport class PrismaNotificationRepository {\r\n  constructor(private readonly prisma: PrismaService) {}\r\n\r\n  async createNotification(data: {\r\n    userId: string;\r\n    type: 'BOOKING_CONFIRMED' | 'BOOKING_CANCELLED' | 'PAYMENT_RECEIVED' | 'PAYMENT_FAILED' | 'PARCEL_STATUS_UPDATE' | 'MESSAGE_RECEIVED' | 'SYSTEM_ALERT';\r\n    title: string;\r\n    content: string;\r\n  }) {\r\n    return this.prisma.notification.create({\r\n      data: {\r\n        ...data,\r\n        isRead: false,\r\n      },\r\n    });\r\n  }\r\n\r\n  async findNotificationsByUser(userId: string) {\r\n    return this.prisma.notification.findMany({\r\n      where: { userId },\r\n      orderBy: { createdAt: 'desc' },\r\n    });\r\n  }\r\n\r\n  async markAsRead(id: string) {\r\n    return this.prisma.notification.update({\r\n      where: { id },\r\n      data: { isRead: true },\r\n    });\r\n  }\r\n\r\n  async markAllAsRead(userId: string) {\r\n    return this.prisma.notification.updateMany({\r\n      where: { userId, isRead: false },\r\n      data: { isRead: true },\r\n    });\r\n  }\r\n\r\n  async getUnreadCount(userId: string) {\r\n    return this.prisma.notification.count({\r\n      where: { userId, isRead: false },\r\n    });\r\n  }\r\n}\r\n","import { Module, Global } from '@nestjs/common';\r\nimport { ConfigModule } from '@nestjs/config';\r\n\r\n// Shared Prisma Module\r\nimport { PrismaModule, PrismaService } from '@going-monorepo-clean/prisma-client';\r\n\r\n// Repository\r\nimport { PrismaNotificationRepository } from './persistence/prisma-notification.repository';\r\n\r\nexport const I_NOTIFICATION_REPOSITORY = Symbol('INotificationRepository');\r\n\r\n@Global()\r\n@Module({\r\n  imports: [\r\n    ConfigModule.forRoot({ isGlobal: true }),\r\n    PrismaModule,\r\n  ],\r\n  providers: [\r\n    PrismaNotificationRepository,\r\n    {\r\n      provide: I_NOTIFICATION_REPOSITORY,\r\n      useClass: PrismaNotificationRepository,\r\n    },\r\n  ],\r\n  exports: [I_NOTIFICATION_REPOSITORY, PrismaNotificationRepository, PrismaService],\r\n})\r\nexport class InfrastructureModule {}","import { Module } from '@nestjs/common';\r\nimport { ConfigModule } from '@nestjs/config';\r\nimport { InfrastructureModule } from './infrastructure/infrastructure.module';\r\n\r\n@Module({\r\n  imports: [\r\n    ConfigModule.forRoot({ isGlobal: true }),\r\n    InfrastructureModule,\r\n  ],\r\n  controllers: [],\r\n  providers: [],\r\n})\r\nexport class AppModule {}","import { NestFactory } from '@nestjs/core';\r\nimport { AppModule } from './app.module';\r\nimport { Logger, ValidationPipe } from '@nestjs/common';\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n  const port = process.env.PORT || 3007;\r\n  app.useGlobalPipes(new ValidationPipe({ whitelist: true, transform: true }));\r\n  await app.listen(port);\r\n  Logger.log(\r\n    `ðŸš€ Notifications-Service estÃ¡ corriendo en http://localhost:${port}`,\r\n    'Bootstrap',\r\n  );\r\n}\r\nbootstrap();"],"names":["require","PrismaService","PrismaClient","constructor","super","log","process","env","NODE_ENV","logger","Logger","name","onModuleInit","this","$connect","error","onModuleDestroy","$disconnect","executeTransaction","fn","$transaction","cleanDatabase","Error","tablenames","$queryRaw","tablename","$executeRawUnsafe","Injectable","PrismaModule","Global","Module","providers","exports","PrismaNotificationRepository","prisma","createNotification","data","notification","create","isRead","findNotificationsByUser","userId","findMany","where","orderBy","createdAt","markAsRead","id","update","markAllAsRead","updateMany","getUnreadCount","count","I_NOTIFICATION_REPOSITORY","Symbol","InfrastructureModule","imports","ConfigModule","forRoot","isGlobal","provide","useClass","AppModule","controllers","app","NestFactory","port","PORT","useGlobalPipes","ValidationPipe","whitelist","transform","listen","bootstrap"],"ignoreList":[],"sourceRoot":""}