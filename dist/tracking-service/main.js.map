{"version":3,"file":"main.js","mappings":"mBAAA,MAAM,EAA+BA,QAAQ,SCAvC,EAA+BA,QAAQ,gBCAvC,EAA+BA,QAAQ,kBCAvC,EAA+BA,QAAQ,kBCAvC,EAA+BA,QAAQ,kB,MCItC,IAAMC,EAAa,EAAnB,MAAMA,sBAAsB,EAAAC,aAGjC,WAAAC,GACEC,MAAM,CACJC,IAA8B,gBAAzBC,QAAQC,IAAIC,SACb,CAAC,QAAS,OAAQ,OAAQ,SAC1B,CAAC,WANQ,KAAAC,OAAS,IAAI,EAAAC,OAAO,EAAcC,KAQnD,CAEM,YAAAC,G,qDACJ,UACQC,KAAKC,WACXD,KAAKJ,OAAOJ,IAAI,mCAClB,CAAE,MAAOU,GAEP,MADAF,KAAKJ,OAAOM,MAAM,2CAA4CA,GACxDA,CACR,CACF,E,CAEM,eAAAC,G,2DACEH,KAAKI,cACXJ,KAAKJ,OAAOJ,IAAI,wCAClB,E,CAMM,kBAAAa,CACJC,G,qDAEA,OAAON,KAAKO,aAAaD,EAC3B,E,CAMM,aAAAE,G,qDACJ,GAA6B,SAAzBf,QAAQC,IAAIC,SACd,MAAM,IAAIc,MAAM,sDAGlB,MAAMC,QAAmBV,KAAKW,SAAuC;;MAIrE,IAAK,MAAM,UAAEC,KAAeF,EACR,uBAAdE,UACIZ,KAAKa,kBAAkB,4BAA4BD,eAG/D,E,GAtDWxB,EAAa,qBADzB,IAAA0B,e,yCACY1B,GCIN,IAAM2B,EAAN,MAAMA,e,MAAAA,GAAY,kBALxB,IAAAC,WACA,IAAAC,QAAO,CACNC,UAAW,CAAC9B,GACZ+B,QAAS,CAAC/B,MAEC2B,GCJN,IAAMK,EAAN,MAAMA,yBACX,WAAA9B,CAA6B+B,GAAA,KAAAA,OAAAA,CAAwB,CAE/C,mBAAAC,CAAoBC,G,qDAMxB,OAAOvB,KAAKqB,OAAOG,cAAcC,OAAO,CACtCF,KAAM,OAAF,wBACCA,GAAI,CACPG,UAAW,IAAIC,QAGrB,E,CAEM,kBAAAC,CAAmBC,G,qDACvB,OAAO7B,KAAKqB,OAAOG,cAAcM,SAAS,CACxCC,MAAO,CAAEF,YACTG,QAAS,CAAEN,UAAW,SAE1B,E,CAEM,cAAAO,CAAeJ,G,qDACnB,OAAO7B,KAAKqB,OAAOG,cAAcU,UAAU,CACzCH,MAAO,CAAEF,YACTG,QAAS,CAAEN,UAAW,SAE1B,E,GA7BWN,GAAwB,kBADpC,IAAAN,e,qCAEmD,mB,OAAA,IAAb1B,GAAAA,GAAa,YADvCgC,GCKN,MAAMe,EAAwBC,OAAO,uBAiBrC,IAAMC,EAAN,MAAMA,uBAAAA,GAAoB,kBAfhC,IAAArB,WACA,IAAAC,QAAO,CACNqB,QAAS,CACP,EAAAC,aAAaC,QAAQ,CAAEC,UAAU,IACjC1B,GAEFG,UAAW,CACTE,EACA,CACEsB,QAASP,EACTQ,SAAUvB,IAGdD,QAAS,CAACgB,EAAuBf,EAA0BhC,MAEhDiD,GCdN,IAAMO,EAAN,MAAMA,YAAAA,GAAS,kBARrB,IAAA3B,QAAO,CACNqB,QAAS,CACP,EAAAC,aAAaC,QAAQ,CAAEC,UAAU,IACjCJ,GAEFQ,YAAa,GACb3B,UAAW,MAEA0B,GCRb,Y,8CACE,MAAME,QAAY,EAAAC,YAAYtB,OAAOmB,GAC/BI,EAAOvD,QAAQC,IAAIuD,MAAQ,KACjCH,EAAII,eAAe,IAAI,EAAAC,eAAe,CAAEC,WAAW,EAAMC,WAAW,WAC9DP,EAAIQ,OAAON,GACjB,EAAAnD,OAAOL,IACL,0FAA6EwD,IAC7E,YAEJ,E,CACAO,E","sources":["external commonjs \"tslib\"","external commonjs \"@nestjs/core\"","external commonjs \"@nestjs/common\"","external commonjs \"@nestjs/config\"","external commonjs \"@prisma/client\"","C:\\Users\\USER1\\going-monorepo-clean\\libs\\shared\\prisma-client\\src\\lib\\prisma.service.ts","C:\\Users\\USER1\\going-monorepo-clean\\libs\\shared\\prisma-client\\src\\lib\\prisma.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\tracking-service\\src\\infrastructure\\persistence\\prisma-tracking.repository.ts","C:\\Users\\USER1\\going-monorepo-clean\\tracking-service\\src\\infrastructure\\infrastructure.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\tracking-service\\src\\app.module.ts","C:\\Users\\USER1\\going-monorepo-clean\\tracking-service\\src\\main.ts"],"sourcesContent":["const __WEBPACK_NAMESPACE_OBJECT__ = require(\"tslib\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/core\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/common\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@nestjs/config\");","const __WEBPACK_NAMESPACE_OBJECT__ = require(\"@prisma/client\");","import { Injectable, OnModuleInit, OnModuleDestroy, Logger } from '@nestjs/common';\r\nimport { PrismaClient } from '@prisma/client';\r\n\r\n@Injectable()\r\nexport class PrismaService extends PrismaClient implements OnModuleInit, OnModuleDestroy {\r\n  private readonly logger = new Logger(PrismaService.name);\r\n\r\n  constructor() {\r\n    super({\r\n      log: process.env.NODE_ENV === 'development' \r\n        ? ['query', 'info', 'warn', 'error'] \r\n        : ['error'],\r\n    });\r\n  }\r\n\r\n  async onModuleInit() {\r\n    try {\r\n      await this.$connect();\r\n      this.logger.log('Connected to PostgreSQL database');\r\n    } catch (error) {\r\n      this.logger.error('Failed to connect to PostgreSQL database', error);\r\n      throw error;\r\n    }\r\n  }\r\n\r\n  async onModuleDestroy() {\r\n    await this.$disconnect();\r\n    this.logger.log('Disconnected from PostgreSQL database');\r\n  }\r\n\r\n  /**\r\n   * Execute operations within a transaction\r\n   * All operations succeed or all fail together\r\n   */\r\n  async executeTransaction<T>(\r\n    fn: (tx: Omit<PrismaClient, '$connect' | '$disconnect' | '$on' | '$transaction' | '$use'>) => Promise<T>,\r\n  ): Promise<T> {\r\n    return this.$transaction(fn);\r\n  }\r\n\r\n  /**\r\n   * Clean database for testing purposes\r\n   * WARNING: This deletes all data!\r\n   */\r\n  async cleanDatabase() {\r\n    if (process.env.NODE_ENV !== 'test') {\r\n      throw new Error('cleanDatabase can only be used in test environment');\r\n    }\r\n    \r\n    const tablenames = await this.$queryRaw<Array<{ tablename: string }>>`\r\n      SELECT tablename FROM pg_tables WHERE schemaname='public'\r\n    `;\r\n\r\n    for (const { tablename } of tablenames) {\r\n      if (tablename !== '_prisma_migrations') {\r\n        await this.$executeRawUnsafe(`TRUNCATE TABLE \"public\".\"${tablename}\" CASCADE;`);\r\n      }\r\n    }\r\n  }\r\n}\r\n","import { Global, Module } from '@nestjs/common';\r\nimport { PrismaService } from './prisma.service';\r\n\r\n@Global()\r\n@Module({\r\n  providers: [PrismaService],\r\n  exports: [PrismaService],\r\n})\r\nexport class PrismaModule {}\r\n","import { Injectable } from '@nestjs/common';\r\nimport { PrismaService } from '@going-monorepo-clean/prisma-client';\r\n\r\n@Injectable()\r\nexport class PrismaTrackingRepository {\r\n  constructor(private readonly prisma: PrismaService) {}\r\n\r\n  async createTrackingEvent(data: {\r\n    parcelId: string;\r\n    status: string;\r\n    location?: string;\r\n    description?: string;\r\n  }) {\r\n    return this.prisma.trackingEvent.create({\r\n      data: {\r\n        ...data,\r\n        timestamp: new Date(),\r\n      },\r\n    });\r\n  }\r\n\r\n  async findEventsByParcel(parcelId: string) {\r\n    return this.prisma.trackingEvent.findMany({\r\n      where: { parcelId },\r\n      orderBy: { timestamp: 'desc' },\r\n    });\r\n  }\r\n\r\n  async getLatestEvent(parcelId: string) {\r\n    return this.prisma.trackingEvent.findFirst({\r\n      where: { parcelId },\r\n      orderBy: { timestamp: 'desc' },\r\n    });\r\n  }\r\n}\r\n","import { Module, Global } from '@nestjs/common';\r\nimport { ConfigModule } from '@nestjs/config';\r\n\r\n// Shared Prisma Module\r\nimport { PrismaModule, PrismaService } from '@going-monorepo-clean/prisma-client';\r\n\r\n// Repository\r\nimport { PrismaTrackingRepository } from './persistence/prisma-tracking.repository';\r\n\r\nexport const I_TRACKING_REPOSITORY = Symbol('ITrackingRepository');\r\n\r\n@Global()\r\n@Module({\r\n  imports: [\r\n    ConfigModule.forRoot({ isGlobal: true }),\r\n    PrismaModule,\r\n  ],\r\n  providers: [\r\n    PrismaTrackingRepository,\r\n    {\r\n      provide: I_TRACKING_REPOSITORY,\r\n      useClass: PrismaTrackingRepository,\r\n    },\r\n  ],\r\n  exports: [I_TRACKING_REPOSITORY, PrismaTrackingRepository, PrismaService],\r\n})\r\nexport class InfrastructureModule {}","import { Module } from '@nestjs/common';\r\nimport { ConfigModule } from '@nestjs/config';\r\nimport { InfrastructureModule } from './infrastructure/infrastructure.module';\r\n\r\n@Module({\r\n  imports: [\r\n    ConfigModule.forRoot({ isGlobal: true }),\r\n    InfrastructureModule,\r\n  ],\r\n  controllers: [],\r\n  providers: [],\r\n})\r\nexport class AppModule {}","import { NestFactory } from '@nestjs/core';\r\nimport { AppModule } from './app.module';\r\nimport { Logger, ValidationPipe } from '@nestjs/common';\r\n\r\nasync function bootstrap() {\r\n  const app = await NestFactory.create(AppModule);\r\n  const port = process.env.PORT || 3008;\r\n  app.useGlobalPipes(new ValidationPipe({ whitelist: true, transform: true }));\r\n  await app.listen(port);\r\n  Logger.log(\r\n    `ðŸš€ Tracking-Service (HTTP y WebSocket) estÃ¡ corriendo en http://localhost:${port}`,\r\n    'Bootstrap',\r\n  );\r\n}\r\nbootstrap();"],"names":["require","PrismaService","PrismaClient","constructor","super","log","process","env","NODE_ENV","logger","Logger","name","onModuleInit","this","$connect","error","onModuleDestroy","$disconnect","executeTransaction","fn","$transaction","cleanDatabase","Error","tablenames","$queryRaw","tablename","$executeRawUnsafe","Injectable","PrismaModule","Global","Module","providers","exports","PrismaTrackingRepository","prisma","createTrackingEvent","data","trackingEvent","create","timestamp","Date","findEventsByParcel","parcelId","findMany","where","orderBy","getLatestEvent","findFirst","I_TRACKING_REPOSITORY","Symbol","InfrastructureModule","imports","ConfigModule","forRoot","isGlobal","provide","useClass","AppModule","controllers","app","NestFactory","port","PORT","useGlobalPipes","ValidationPipe","whitelist","transform","listen","bootstrap"],"ignoreList":[],"sourceRoot":""}