{"version":3,"sources":["../../../../../../../libs/domains/notification-frontend/src/lib/application/get-user-notifications.use-case.ts"],"sourcesContent":["import { Injectable } from '@nestjs/common';\r\nimport { Result, ok, err } from 'neverthrow';\r\nimport { NotificationApiClient, NotificationDto } from '@going-monorepo-clean/notification-api-client'; // <--- NUEVA DEPENDENCIA\r\nimport { IAuthRepository } from '@going-monorepo-clean/domains-user-frontend-core';\r\nimport { UUID } from '@going-monorepo-clean/shared-domain';\r\n\r\n// --- View Model (Nuevo Modelo Simple para la UI) ---\r\nexport interface NotificationViewModel {\r\n    id: UUID;\r\n    title: string;\r\n    body: string;\r\n    isRead: boolean;\r\n    timeAgo: string; // Para la UI\r\n}\r\n\r\n@Injectable()\r\nexport class GetUserNotificationsUseCase {\r\n    private readonly apiClient: NotificationApiClient;\r\n    private readonly authRepository: IAuthRepository;\r\n\r\n    constructor(authRepository: IAuthRepository /* La inyección real de tu provider */) {\r\n        this.apiClient = new NotificationApiClient(); \r\n        this.authRepository = authRepository;\r\n    }\r\n\r\n    async execute(userId: UUID): Promise<Result<NotificationViewModel[], Error>> {\r\n        const sessionResult = await this.authRepository.loadSession();\r\n        if (sessionResult.isErr() || !sessionResult.value) {\r\n            return err(new Error('No estás autenticado.'));\r\n        }\r\n        const token = sessionResult.value.token;\r\n        \r\n        // 1. Llamar al Adaptador (API Client)\r\n        const result = await this.apiClient.getByUserId(userId, token);\r\n\r\n        if (result.isErr()) {\r\n            return err(result.error);\r\n        }\r\n        \r\n        // 2. Mapear DTOs simples a View Models (Transformación)\r\n        const viewModels: NotificationViewModel[] = result.value.map(dto => ({\r\n            id: dto.id,\r\n            title: dto.title,\r\n            body: dto.body,\r\n            isRead: dto.status === 'READ',\r\n            timeAgo: 'Justo ahora', // Aquí iría la lógica real de date-fns\r\n        }));\r\n\r\n        return ok(viewModels);\r\n    }\r\n}"],"names":["GetUserNotificationsUseCase","execute","userId","sessionResult","authRepository","loadSession","isErr","value","err","Error","token","result","apiClient","getByUserId","error","viewModels","map","dto","id","title","body","isRead","status","timeAgo","ok","constructor","NotificationApiClient","Injectable"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAgBaA;;;eAAAA;;;;;wBAhBc;4BACK;uCACuB;yCACvB;AAazB,IAAA,AAAMA,8BAAN,MAAMA;IAST,MAAMC,QAAQC,MAAY,EAAmD;QACzE,MAAMC,gBAAgB,MAAM,IAAI,CAACC,cAAc,CAACC,WAAW;QAC3D,IAAIF,cAAcG,KAAK,MAAM,CAACH,cAAcI,KAAK,EAAE;YAC/C,OAAOC,IAAAA,eAAG,EAAC,IAAIC,MAAM;QACzB;QACA,MAAMC,QAAQP,cAAcI,KAAK,CAACG,KAAK;QAEvC,sCAAsC;QACtC,MAAMC,SAAS,MAAM,IAAI,CAACC,SAAS,CAACC,WAAW,CAACX,QAAQQ;QAExD,IAAIC,OAAOL,KAAK,IAAI;YAChB,OAAOE,IAAAA,eAAG,EAACG,OAAOG,KAAK;QAC3B;QAEA,wDAAwD;QACxD,MAAMC,aAAsCJ,OAAOJ,KAAK,CAACS,GAAG,CAACC,CAAAA,MAAQ,CAAA;gBACjEC,IAAID,IAAIC,EAAE;gBACVC,OAAOF,IAAIE,KAAK;gBAChBC,MAAMH,IAAIG,IAAI;gBACdC,QAAQJ,IAAIK,MAAM,KAAK;gBACvBC,SAAS;YACb,CAAA;QAEA,OAAOC,IAAAA,cAAE,EAACT;IACd;IA7BAU,YAAYrB,cAA+B,AAAC,oCAAoC,IAAI;QAChF,IAAI,CAACQ,SAAS,GAAG,IAAIc,4CAAqB;QAC1C,IAAI,CAACtB,cAAc,GAAGA;IAC1B;AA2BJ;AAlCaJ;IADZ2B,IAAAA,kBAAU;;;eAKqB,wCAAe,4BAAf,wCAAe;;GAJlC3B"}