{"version":3,"sources":["../../../../../../../libs/domains/parcel-frontend/src/lib/ports/http-parcel.repository.ts"],"sourcesContent":["import { Result, ok, err } from 'neverthrow';\r\nimport {\r\n  Parcel,\r\n  IParcelRepository,\r\n  CreateParcelData,\r\n} from '@going-monorepo-clean/domains-parcel-frontend-core';\r\nimport { UUID } from '@going-monorepo-clean/shared-domain';\r\n\r\nconst API_GATEWAY_URL = 'http://localhost:3000/api';\r\n\r\nexport class HttpParcelRepository implements IParcelRepository {\r\n  \r\n  public async create(data: CreateParcelData, token: string): Promise<Result<Parcel, Error>> {\r\n    try {\r\n      const body = {\r\n        userId: data.userId,\r\n        origin: data.origin.toPrimitives(),\r\n        destination: data.destination.toPrimitives(),\r\n        description: data.description,\r\n        price: data.price.toPrimitives(),\r\n      };\r\n\r\n      const response = await fetch(`${API_GATEWAY_URL}/parcels`, {\r\n        method: 'POST',\r\n        headers: {\r\n          'Content-Type': 'application/json',\r\n          'Authorization': `Bearer ${token}`,\r\n        },\r\n        body: JSON.stringify(body),\r\n      });\r\n\r\n      const responseData = await response.json();\r\n\r\n      if (!response.ok) {\r\n        return err(new Error(responseData.message || 'Error al crear el envío'));\r\n      }\r\n\r\n      const parcel = Parcel.fromPrimitives(responseData);\r\n      return ok(parcel);\r\n      \r\n    } catch (error: any) {\r\n      return err(new Error(error.message || 'Error de red al crear el envío'));\r\n    }\r\n  }\r\n\r\n  public async getByUser(userId: UUID, token: string): Promise<Result<Parcel[], Error>> {\r\n    try {\r\n      const response = await fetch(`${API_GATEWAY_URL}/parcels/user/${userId}`, {\r\n        method: 'GET',\r\n        headers: { 'Authorization': `Bearer ${token}` },\r\n      });\r\n\r\n      const responseData = await response.json();\r\n\r\n      if (!response.ok) {\r\n        return err(new Error(responseData.message || 'Error al obtener los envíos'));\r\n      }\r\n\r\n      const parcels = responseData.map((data: any) => Parcel.fromPrimitives(data));\r\n      return ok(parcels);\r\n\r\n    } catch (error: any) {\r\n      return err(new Error('Error de red al obtener los envíos'));\r\n    }\r\n  }\r\n\r\n  public async getTrackingStatus(parcelId: UUID, token: string): Promise<Result<Parcel, Error>> {\r\n    try {\r\n      const response = await fetch(`${API_GATEWAY_URL}/parcels/${parcelId}/status`, {\r\n        method: 'GET',\r\n        headers: { 'Authorization': `Bearer ${token}` },\r\n      });\r\n\r\n      const responseData = await response.json();\r\n\r\n      if (!response.ok) {\r\n        return err(new Error(responseData.message || 'Error al obtener el estado'));\r\n      }\r\n\r\n      const parcel = Parcel.fromPrimitives(responseData);\r\n      return ok(parcel);\r\n    } catch (error: any) {\r\n      return err(new Error('Error de red al obtener el tracking'));\r\n    }\r\n  }\r\n}"],"names":["HttpParcelRepository","API_GATEWAY_URL","create","data","token","body","userId","origin","toPrimitives","destination","description","price","response","fetch","method","headers","JSON","stringify","responseData","json","ok","err","Error","message","parcel","Parcel","fromPrimitives","error","getByUser","parcels","map","getTrackingStatus","parcelId"],"rangeMappings":";;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;","mappings":";;;;+BAUaA;;;eAAAA;;;4BAVmB;2CAKzB;AAGP,MAAMC,kBAAkB;AAEjB,IAAA,AAAMD,uBAAN,MAAMA;IAEX,MAAaE,OAAOC,IAAsB,EAAEC,KAAa,EAAkC;QACzF,IAAI;YACF,MAAMC,OAAO;gBACXC,QAAQH,KAAKG,MAAM;gBACnBC,QAAQJ,KAAKI,MAAM,CAACC,YAAY;gBAChCC,aAAaN,KAAKM,WAAW,CAACD,YAAY;gBAC1CE,aAAaP,KAAKO,WAAW;gBAC7BC,OAAOR,KAAKQ,KAAK,CAACH,YAAY;YAChC;YAEA,MAAMI,WAAW,MAAMC,MAAM,CAAC,EAAEZ,gBAAgB,QAAQ,CAAC,EAAE;gBACzDa,QAAQ;gBACRC,SAAS;oBACP,gBAAgB;oBAChB,iBAAiB,CAAC,OAAO,EAAEX,MAAM,CAAC;gBACpC;gBACAC,MAAMW,KAAKC,SAAS,CAACZ;YACvB;YAEA,MAAMa,eAAe,MAAMN,SAASO,IAAI;YAExC,IAAI,CAACP,SAASQ,EAAE,EAAE;gBAChB,OAAOC,IAAAA,eAAG,EAAC,IAAIC,MAAMJ,aAAaK,OAAO,IAAI;YAC/C;YAEA,MAAMC,SAASC,iCAAM,CAACC,cAAc,CAACR;YACrC,OAAOE,IAAAA,cAAE,EAACI;QAEZ,EAAE,OAAOG,OAAY;YACnB,OAAON,IAAAA,eAAG,EAAC,IAAIC,MAAMK,MAAMJ,OAAO,IAAI;QACxC;IACF;IAEA,MAAaK,UAAUtB,MAAY,EAAEF,KAAa,EAAoC;QACpF,IAAI;YACF,MAAMQ,WAAW,MAAMC,MAAM,CAAC,EAAEZ,gBAAgB,cAAc,EAAEK,OAAO,CAAC,EAAE;gBACxEQ,QAAQ;gBACRC,SAAS;oBAAE,iBAAiB,CAAC,OAAO,EAAEX,MAAM,CAAC;gBAAC;YAChD;YAEA,MAAMc,eAAe,MAAMN,SAASO,IAAI;YAExC,IAAI,CAACP,SAASQ,EAAE,EAAE;gBAChB,OAAOC,IAAAA,eAAG,EAAC,IAAIC,MAAMJ,aAAaK,OAAO,IAAI;YAC/C;YAEA,MAAMM,UAAUX,aAAaY,GAAG,CAAC,CAAC3B,OAAcsB,iCAAM,CAACC,cAAc,CAACvB;YACtE,OAAOiB,IAAAA,cAAE,EAACS;QAEZ,EAAE,OAAOF,OAAY;YACnB,OAAON,IAAAA,eAAG,EAAC,IAAIC,MAAM;QACvB;IACF;IAEA,MAAaS,kBAAkBC,QAAc,EAAE5B,KAAa,EAAkC;QAC5F,IAAI;YACF,MAAMQ,WAAW,MAAMC,MAAM,CAAC,EAAEZ,gBAAgB,SAAS,EAAE+B,SAAS,OAAO,CAAC,EAAE;gBAC5ElB,QAAQ;gBACRC,SAAS;oBAAE,iBAAiB,CAAC,OAAO,EAAEX,MAAM,CAAC;gBAAC;YAChD;YAEA,MAAMc,eAAe,MAAMN,SAASO,IAAI;YAExC,IAAI,CAACP,SAASQ,EAAE,EAAE;gBAChB,OAAOC,IAAAA,eAAG,EAAC,IAAIC,MAAMJ,aAAaK,OAAO,IAAI;YAC/C;YAEA,MAAMC,SAASC,iCAAM,CAACC,cAAc,CAACR;YACrC,OAAOE,IAAAA,cAAE,EAACI;QACZ,EAAE,OAAOG,OAAY;YACnB,OAAON,IAAAA,eAAG,EAAC,IAAIC,MAAM;QACvB;IACF;AACF"}