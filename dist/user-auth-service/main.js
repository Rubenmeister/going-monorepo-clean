(()=>{"use strict";const e=require("tslib"),t=(require("reflect-metadata"),require("@nestjs/common")),o=require("@nestjs/core"),r=require("@nestjs/config"),i=require("@nestjs/mongoose"),a=require("mongoose");let n=class User{};(0,e.__decorate)([(0,i.Prop)({required:!0}),(0,e.__metadata)("design:type",String)],n.prototype,"name",void 0),(0,e.__decorate)([(0,i.Prop)({required:!0,unique:!0}),(0,e.__metadata)("design:type",String)],n.prototype,"email",void 0),(0,e.__decorate)([(0,i.Prop)({required:!0}),(0,e.__metadata)("design:type",String)],n.prototype,"password",void 0),n=(0,e.__decorate)([(0,i.Schema)()],n);const s=i.SchemaFactory.createForClass(n);var d;let c=class AuthService{constructor(e){this.userModel=e}register(t){return(0,e.__awaiter)(this,void 0,void 0,function*(){return new this.userModel(t).save()})}login(o){return(0,e.__awaiter)(this,void 0,void 0,function*(){const e=yield this.userModel.findOne({email:o.email});if(!e)throw new t.UnauthorizedException("Usuario no encontrado");if(e.password!==o.password)throw new t.UnauthorizedException("Contrase\xf1a incorrecta");return{message:"Login exitoso",user:{id:e._id,name:e.name,email:e.email,role:"CONDUCTOR"},access_token:"token_falso_demo_123"}})}findAll(){return(0,e.__awaiter)(this,void 0,void 0,function*(){return this.userModel.find().exec()})}};var u;c=(0,e.__decorate)([(0,t.Injectable)(),(0,e.__param)(0,(0,i.InjectModel)(n.name)),(0,e.__metadata)("design:paramtypes",["function"==typeof(d=void 0!==a.Model&&a.Model)?d:Object])],c);let _=class AuthController{constructor(e){this.authService=e}register(t){return(0,e.__awaiter)(this,void 0,void 0,function*(){return this.authService.register(t)})}login(t){return(0,e.__awaiter)(this,void 0,void 0,function*(){return this.authService.login(t)})}getUsers(){return(0,e.__awaiter)(this,void 0,void 0,function*(){return this.authService.findAll()})}};(0,e.__decorate)([(0,t.Post)("register"),(0,e.__param)(0,(0,t.Body)()),(0,e.__metadata)("design:type",Function),(0,e.__metadata)("design:paramtypes",[Object]),(0,e.__metadata)("design:returntype",Promise)],_.prototype,"register",null),(0,e.__decorate)([(0,t.Post)("login"),(0,t.HttpCode)(t.HttpStatus.OK),(0,e.__param)(0,(0,t.Body)()),(0,e.__metadata)("design:type",Function),(0,e.__metadata)("design:paramtypes",[Object]),(0,e.__metadata)("design:returntype",Promise)],_.prototype,"login",null),(0,e.__decorate)([(0,t.Get)("users"),(0,e.__metadata)("design:type",Function),(0,e.__metadata)("design:paramtypes",[]),(0,e.__metadata)("design:returntype",Promise)],_.prototype,"getUsers",null),_=(0,e.__decorate)([(0,t.Controller)("auth"),(0,e.__metadata)("design:paramtypes",["function"==typeof(u=void 0!==c&&c)?u:Object])],_);let l=class AuthModule{};l=(0,e.__decorate)([(0,t.Module)({imports:[i.MongooseModule.forFeature([{name:n.name,schema:s}])],controllers:[_],providers:[c]})],l);let p=class AppModule{};p=(0,e.__decorate)([(0,t.Module)({imports:[r.ConfigModule.forRoot({isGlobal:!0,envFilePath:".env"}),i.MongooseModule.forRootAsync({imports:[r.ConfigModule],useFactory:t=>(0,e.__awaiter)(void 0,void 0,void 0,function*(){return{uri:t.get("MONGO_URI")}}),inject:[r.ConfigService]}),l],controllers:[],providers:[]})],p),function(){(0,e.__awaiter)(this,void 0,void 0,function*(){const e=new t.Logger("Bootstrap");try{const r=yield o.NestFactory.create(p);r.enableCors(),r.setGlobalPrefix("api"),r.useGlobalPipes(new t.ValidationPipe({whitelist:!0,transform:!0}));const i=process.env.PORT||3333;yield r.listen(i),e.log(`\ud83d\ude80 BACKEND LISTO en: http://localhost:${i}/api`)}catch(r){e.error("\u274c ERROR FATAL:",r),process.exit(1)}})}()})();
//# sourceMappingURL=main.js.map